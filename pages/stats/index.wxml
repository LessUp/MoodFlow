<view class="container {{theme === 'dark' ? 'theme-dark' : 'theme-light'}}">
  <view class="section">
    <view class="label">趋势与占比</view>
    <view class="seg">
      <view class="seg-item {{granularity === 'day' ? 'on' : ''}}" data-g="day" bindtap="onGranularityTap">日</view>
      <view class="seg-item {{granularity === 'week' ? 'on' : ''}}" data-g="week" bindtap="onGranularityTap">周</view>
      <view class="seg-item {{granularity === 'month' ? 'on' : ''}}" data-g="month" bindtap="onGranularityTap">月</view>
    </view>
    <block wx:if="{{useEcharts}}">
      <ec-canvas id="trendEC" canvas-id="trendEC" class="chart"></ec-canvas>
      <ec-canvas id="pieEC" canvas-id="pieEC" class="chart"></ec-canvas>
      <view class="hint">图表由 ECharts 渲染</view>
    </block>
    <block wx:else>
      <canvas canvas-id="trendCanvas" class="chart"></canvas>
      <canvas canvas-id="pieCanvas" class="chart"></canvas>
      <view class="hint">图表由 Canvas 绘制（未集成 ECharts）</view>
    </block>
  </view>
  <view wx:if="{{totalCount === 0}}" class="section empty">
    <view class="empty-title">暂无数据</view>
    <view class="empty-tip">去日历页记录今日心情吧</view>
  </view>

  <view wx:if="{{totalCount > 0}}" class="section">
    <view class="label">连续记录天数</view>
    <view class="value large">{{streakDays}} 天</view>
  </view>

  <view wx:if="{{totalCount > 0}}" class="section">
    <view class="label">全部分布</view>
    <view class="grid">
      <block wx:for="{{moodCounts}}" wx:key="mood">
        <view class="cell">
          <text class="emoji">{{item.mood}}</text>
          <text class="count">{{item.count}}</text>
        </view>
      </block>
    </view>
  </view>

  <view wx:if="{{totalCount > 0}}" class="section">
    <view class="label">{{monthLabel}} 分布</view>
    <view class="grid">
      <block wx:for="{{monthMoodCounts}}" wx:key="mood">
        <view class="cell">
          <text class="emoji">{{item.mood}}</text>
          <text class="count">{{item.count}}</text>
        </view>
      </block>
    </view>
  </view>
</view>
